

# Note:
# Make sure that the github pages is already set to Github Actions, otherwise the workflow will fail.
#
# Author: Shubham Gupta
# GitHub: https://github.com/shubham-gupta-16/
# Created On: 5 Aug, 2022
# Updated On: 18 May, 2024

name: CI
on:
  push:
    branches:
      - master
#  pull_request:
#    branches:
#      - master

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  flutter_web_deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
# If you want to change the directory to run commands
#    defaults:
#      run:
#        working-directory: ./sub-folder
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
#          flutter-version: '3.3.10'  // uncomment this line if you want to use a specific version of Flutter
      - run: flutter pub get
      - run: flutter build web --base-href /${{ github.event.repository.name }}/
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1
        with:
          name: web-build
#          path: sub-folder/build/web // if working-directory is changed
          path: build/web
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
# name: Publish main branch to GitHub Pages

# on:
#   # Triggers the workflow on push or pull request events but only for the "main" branch
#   push:
#     branches: [ "main" ]
#   pull_request:
#     branches: [ "main" ]

#   # Allows you to run this workflow manually from the Actions tab
#   workflow_dispatch:

# # Grant GITHUB_TOKEN the permissions required to make a Pages deployment
# permissions:
#     contents: read
#     pages: write      # to deploy to Pages
#     id-token: write   # to verify the deployment originates from an appropriate source
  
# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:

#       - name: Clone the source repo
#         uses: actions/checkout@v4

#       # https://github.com/marketplace/actions/flutter-action
#       - name: Set up Flutter
#         uses: subosito/flutter-action@v2
#         with:
#           channel: stable
#           flutter-version: 3.24.0

#       - name: Build the web artifact
#         run: |
#           flutter pub get
#           flutter test
#           flutter build web --base-href /${{ github.event.repository.name }}/ --release
    
#       - name: Configure Pages
#         uses: actions/configure-pages@v4

#       # https://stackoverflow.com/a/73450467
#       - name: Upload the web artifact
#         uses: actions/upload-artifact@v4
#         with:
#           name: github-pages
#           path: build/web

#   # https://github.com/actions/deploy-pages
#   deploy:
#     runs-on: ubuntu-latest
#     needs: build
#     environment:
#       name: github-pages
#       url: ${{ steps.deployment.outputs.page_url }}

#     steps:
#       - name: Deploy to GitHub Pages
#         id: deployment
#         uses: actions/deploy-pages@v4
    
